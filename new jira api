let
    // Read the base URL from Excel named range
    BaseUrlTable = Excel.CurrentWorkbook(){[Name="BaseUrl"]}[Content],
    BaseUrl = BaseUrlTable{0}[Column1],

    // Your Jira credentials
    JiraEmail = "kiran_kangula@wsib.on.ca",
    JiraAPIToken = "ATATT3xFfGF0-JbIzAe00uiDRiCKqLklmhXeFbJ1-WWm0o5p5ox8_HgABGaDbfw7OZtpUOXEXOJuwi0BRqq4YMx2p0jnsw55c2DGJ4oN1IqeQ2wtzlcS084RGNkcOGmQfa_B6HMTpShv35I_6pfdW9ug3uYhMP83hHsSuGIf32jnyFVYgkFoqLU=FDA1B9D4",
    AuthKey = Binary.ToText(Text.ToBinary(JiraEmail & ":" & JiraAPIToken), BinaryEncoding.Base64),
    Headers = [
        #"Authorization" = "Basic " & AuthKey,
        #"Accept" = "application/json"
    ],

    // 3. Function to fetch a page
    GetPage = (Token as nullable text) =>
        let
            Url = if Token = null then BaseUrl else BaseUrl & "&pageToken=" & Uri.EscapeDataString(Token),
            Source = Json.Document(Web.Contents(Url, [Headers=Headers]))
        in
            Source,

    // 4. Sequentially fetch pages
    AllPages = List.Generate(
        () => [Response = GetPage(null), Token = null, Continue = true],
        each [Continue],
        each [
            Token = try [Response][nextPageToken] otherwise null,
            Response = if Token <> null then GetPage(Token) else null,
            Continue = Response <> null and Record.HasFields(Response, "issues") and List.Count(Response[issues]) > 0
        ],
        each [Response]
    ),

    // 5. Combine all issues
    AllIssues = List.Combine(List.Transform(AllPages, each [issues])),

    // 6. Convert to table and expand
    IssuesTable = Table.FromList(AllIssues, Splitter.SplitByNothing(), {"Record"}),
    Expanded = Table.ExpandRecordColumn(IssuesTable, "Record", {"id","key","fields"}),

    // 7. Expand fields safely
    FieldsExpanded = Table.ExpandRecordColumn(Expanded, "fields", {"issuetype","summary","priority","status","fixVersions","assignee","created","customfield_10020"}, {"issuetype","summary","priority","status","fixVersions","assignee","created","customfield_10020"}),

    // 8. Expand nested fields
    ExpandIssueType = Table.ExpandRecordColumn(FieldsExpanded, "issuetype", {"name"}, {"Issue Type"}),
    ExpandPriority = Table.ExpandRecordColumn(ExpandIssueType, "priority", {"name"}, {"Priority"}),
    ExpandStatus = Table.ExpandRecordColumn(ExpandPriority, "status", {"name"}, {"Status"}),
    ExpandAssignee = Table.ExpandRecordColumn(ExpandStatus, "assignee", {"displayName"}, {"Assignee"}),

    // 9. Expand lists safely
    ExpandFixVersions = Table.TransformColumns(ExpandAssignee, {"fixVersions", each if _ = null then {} else _, type list}),
    ExpandFixVersions1 = Table.ExpandListColumn(ExpandFixVersions, "fixVersions"),
    ExpandFixVersions2 = Table.ExpandRecordColumn(ExpandFixVersions1, "fixVersions", {"name"}, {"Release Date"}),

    ExpandCustomfield = Table.TransformColumns(ExpandFixVersions2, {"customfield_10020", each if _ = null then {} else _, type list}),
    ExpandCustomfield1 = Table.ExpandListColumn(ExpandCustomfield, "customfield_10020"),
    ExpandCustomfield2 = Table.ExpandRecordColumn(ExpandCustomfield1, "customfield_10020", {"name"}, {"Sprint"}),

    // 10. Rename columns
    Renamed = Table.RenameColumns(ExpandCustomfield2, {{"key","Jira Id"},{"summary","Summary"},{"created","CreatedDate"}}),

    // 11. Group sprints (concatenate)
    Grouped = Table.Group(Renamed, {"Jira Id","Issue Type","Summary","Priority","Status","Release Date","Assignee","CreatedDate"}, {
        {"Sprint", each Text.Combine(List.Transform([Sprint], Text.From), ", "), type text}
    })
in
    Grouped
